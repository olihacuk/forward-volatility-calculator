<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Forward Volatility Calculator</title>
<style>
  body { font-family: system-ui, sans-serif; margin: 2rem; background: #fafafa; color: #222; }
  h1 { font-size: 1.6rem; }
  label { display: inline-block; width: 90px; margin-right: 8px; }
  input { width: 100px; padding: 4px; margin: 4px; }
  button { padding: 6px 12px; margin-right: 6px; cursor: pointer; }
  fieldset { margin-top: 1.2rem; padding: 1rem; border-radius: 8px; border: 1px solid #ccc; background: #fff; }
  .outputs p { margin: 0.2rem 0; }
  .note { font-size: 0.9rem; color: #555; margin-top: 1rem; max-width: 700px; }
  .error { color: #b00; }
</style>
</head>
<body>
<h1>Forward Volatility Calculator</h1>

<p><strong>Formula:</strong><br>
σ<sub>fwd</sub> = √((σ₂²·T₂ − σ₁²·T₁) / (T₂ − T₁))<br>
FF = (σ₁ − σ<sub>fwd</sub>) / σ<sub>fwd</sub></p>

<fieldset>
  <legend>Inputs</legend>
  <div>
    <label>DTE₁ (days)</label><input id="dte1" type="number" step="any">
    <label>IV₁ (%)</label><input id="iv1" type="number" step="any">
  </div>
  <div>
    <label>DTE₂ (days)</label><input id="dte2" type="number" step="any">
    <label>IV₂ (%)</label><input id="iv2" type="number" step="any">
  </div>
  <button onclick="compute()">Compute</button>
  <button onclick="clearFields()">Clear</button>
</fieldset>

<fieldset class="outputs" id="outputs" style="display:none;"></fieldset>

<p class="note">
Notes: Require DTE₂ > DTE₁ ≥ 0 and IVs ≥ 0.
If forward variance is negative, the forward vol is not real (check inputs).
If σ<sub>fwd</sub> = 0, FF is undefined.
</p>

<script>
function compute() {
  const dte1 = parseFloat(document.getElementById('dte1').value);
  const iv1 = parseFloat(document.getElementById('iv1').value);
  const dte2 = parseFloat(document.getElementById('dte2').value);
  const iv2 = parseFloat(document.getElementById('iv2').value);
  const out = document.getElementById('outputs');

  // validate
  if ([dte1, iv1, dte2, iv2].some(isNaN)) {
    alert("Please enter numeric values.");
    return;
  }
  if (dte1 < 0 || dte2 < 0) {
    alert("DTEs must be non-negative.");
    return;
  }
  if (dte2 <= dte1) {
    alert("Require DTE₂ > DTE₁.");
    return;
  }
  if (iv1 < 0 || iv2 < 0) {
    alert("IVs must be non-negative.");
    return;
  }

  const T1 = dte1 / 365, T2 = dte2 / 365;
  const s1 = iv1 / 100, s2 = iv2 / 100;
  const tv1 = s1**2 * T1, tv2 = s2**2 * T2;
  const denom = T2 - T1;
  const fwdVar = (tv2 - tv1) / denom;

  let html = `
    <p>T₁ = ${T1.toFixed(6)} yr &nbsp;&nbsp; σ₁ = ${s1.toFixed(6)}</p>
    <p>T₂ = ${T2.toFixed(6)} yr &nbsp;&nbsp; σ₂ = ${s2.toFixed(6)}</p>
  `;

  if (fwdVar < 0) {
    html += `<p class="error">Forward variance is negative (&lt; 0) — forward volatility is not real. Check inputs.</p>`;
    out.style.display = 'block';
    out.innerHTML = html;
    return;
  }

  const sigmaFwd = Math.sqrt(fwdVar);
  // Handle sigmaFwd == 0 for FF
  let ffText = 'undefined';
  if (sigmaFwd > 0) {
    const ff = (s1 - sigmaFwd) / sigmaFwd;
    ffText = ff.toFixed(6);
  }

  html += `
    <p>Forward variance = ${fwdVar.toExponential(6)}</p>
    <p>σ<sub>fwd</sub> = ${sigmaFwd.toFixed(6)}</p>
    <p>FF = ${ffText}</p>
  `;

  out.style.display = 'block';
  out.innerHTML = html;
}

function clearFields() {
  document.getElementById('dte1').value = '';
  document.getElementById('iv1').value = '';
  document.getElementById('dte2').value = '';
  document.getElementById('iv2').value = '';
  const out = document.getElementById('outputs');
  out.style.display = 'none';
  out.innerHTML = '';
}
</script>
</body>
</html>
